#!/usr/bin/env bash

PROJ_FOLDERS=`echo ~/personal ~/work ~/dots/modules ~/cloned personal/learning ~/vault`
EXTR_FOLDERS=`echo ~/dots ~/dots/bin`

if [[ -n $1 ]] then
  selected=$1
else
  selected=`find $PROJ_FOLDERS -maxdepth 1 -mindepth 1 -type d | cat - <(echo $EXTR_FOLDERS $PROJ_FOLDERS) | sed 's/ /\n/g' | sed 's/\/home\/codies\///g' | sort -r | fzf --tmux top,70%,65% --preview "cd $HOME/{}; git status; echo; ls -lhA"`
fi

if [[ -z $selected ]] then
  exit
fi

path="$HOME/$selected"

tmux_running=$(pgrep tmux)

if [[ -z $TMUX ]] && [[ -z $tmux_running ]]; then
    tmux new-session -s $selected -c $path
    exit
fi

if ! tmux has-session -t=$selected 2> /dev/null; then
    tmux new-session -ds $selected -c $path
fi

tmux switch-client -t $selected
